<%= render 'shared/plays' do %>
  <% if @play.budget_reserve >= 0 %>
    <h2 class="title is-5 has-text-centered">Rezerwa budżetowa: <%= @play.decorate.formatted_budget_reserve %></h2>
  <% else %>
    <h2 class="title is-5 has-text-centered">Zadłużenie budżetu: <span class="is-danger"><%= @play.decorate.formatted_budget_reserve %></span></h2>
  <% end %>

  <% if @active_budget_changes.any? %>
    <div class="table-container budget-table-container">
      <table class="table is-fullwidth is-mobile-stack" style="border-collapse: separate; border-spacing: 0 6px;">
        <thead>
        <tr>
          <th class="has-text-centered"><strong>Zgłaszający</strong></th>
          <th class="has-text-centered"><strong>Nazwa</strong></th>
          <th class="has-text-centered"><strong>Zmiana</strong></th>
          <th class="has-text-centered"><strong>Zagłosowało za</strong></th>
          <th class="has-text-centered"><strong>Zagłosowało przeciw</strong></th>
          <th colspan="2" class="has-text-centered"><strong>Zagłosuj</strong></th>
        </tr>
        </thead>

        <% @active_budget_changes.each do |budget_change| %>
          <tbody class="color-background-on-hover">
          <tr style="padding-top: 6px; padding-bottom: 6px;">
            <td class="has-text-centered">
              <%= link_to profile_path(budget_change.user), data: { turbo: false } do %>
                <%= budget_change.user.name %>
              <% end %>
            </td>

            <td class="has-text-centered">
              <strong><%= budget_change.name %></strong>
              <% if budget_change.reason_not_implemented %>
                <p class="is-danger"><%= budget_change.reason_not_implemented %></p>
              <% end %>
            </td>

            <td class="is-flex is-vcentered is-justify-content-center">
              <% if budget_change.is_adding %>
                <%= icon_tag("plus-circle", options: { class: "is-success" }) %>
              <% else %>
                <%= icon_tag("minus-circle", options: { class: "is-danger" }) %>
              <% end %>
              <span class="ml-1"><%= budget_change.decorate.formatted_value %></span>
            </td>

            <td class="has-text-centered">
              <p title="<%= budget_change.votes_favor_names %>"><%= budget_change.votes_favor_count %></p></td>
            <td class="has-text-centered">
              <p title="<%= budget_change.votes_against_names %>"><%= budget_change.votes_against_count %></p></td>


            <td class="has-text-centered">
              <%= button_to play_budget_vote_path(@play),
                            method: :post,
                            params: { game_budget_change_id: budget_change.id, vote: true },
                            class: "button is-success is-small" do %>
                <%= icon_tag("hand-thumb-up", options: { class: "menu-icon" }) %> Za
              <% end %>
            </td>

            <td class="has-text-centered">
              <%= button_to play_budget_vote_path(@play),
                            method: :post,
                            params: { game_budget_change_id: budget_change.id, vote: false },
                            class: "button is-danger is-small" do %>
                <%= icon_tag("hand-thumb-down", options: { class: "menu-icon" }) %> Przeciw
              <% end %>
            </td>
          </tr>
          </tbody>
        <% end %>
      </table>
    </div>
  <% else %>
    <p class="has-text-centered">Brak zmian, za którymi można głosować.</p>
  <% end %>

  <% if @un_active_budget_changes.any? %>
    <h2 class="title is-5 has-text-centered mt-5">Historia zmian</h2>
    <div class="table-container budget-table-container">
      <table class="table is-fullwidth is-mobile-stack" style="border-collapse: separate; border-spacing: 0 6px;">
        <thead>
        <tr class="has-text-centered">
          <th class="has-text-centered"><strong>Zgłaszający</strong></th>
          <th class="has-text-centered"><strong>Nazwa</strong></th>
          <th class="has-text-centered"><strong>Czy wdrożono</strong></th>
          <th class="has-text-centered"><strong>Zmiana</strong></th>
          <th class="has-text-centered"><strong>Zagłosowało za</strong></th>
          <th class="has-text-centered"><strong>Zagłosowało przeciw</strong></th>
        </tr>
        </thead>
        <% @un_active_budget_changes.each do |budget_change| %>
          <tbody class="color-background-on-hover">
          <tr style="padding-top: 6px; padding-bottom: 6px;">
            <td class="has-text-centered">
              <%= link_to profile_path(budget_change.user), data: { turbo: false } do %>
                <%= budget_change.user.name %>
              <% end %>
            </td>
            <td class="has-text-centered"><strong><%= budget_change.name %></strong></td>
            <td class="has-text-centered">
              <% if budget_change.was_implement? %>
                <%= icon_tag("hand-thumb-up", options: { class: "menu-icon is-success" }) %> Wdrożono
              <% else %>
                <%= icon_tag("hand-thumb-down", options: { class: "menu-icon is-danger" }) %> Nie wdrożono
              <% end %>
            </td>
            <td class="is-flex is-vcentered is-justify-content-center">
              <% if budget_change.is_adding %>
                <%= icon_tag("plus-circle", options: { class: "is-success" }) %>
              <% else %>
                <%= icon_tag("minus-circle", options: { class: "is-danger" }) %>
              <% end %>
              <span class="ml-1"><%= budget_change.decorate.formatted_value %></span>
            </td>
            <td class="has-text-centered">
              <p title="<%= budget_change.votes_favor_names %>"><%= budget_change.votes_favor_count %></p></td>
            <td class="has-text-centered">
              <p title="<%= budget_change.votes_against_names %>"><%= budget_change.votes_against_count %></p></td>
          </tr>
          </tbody>
        <% end %>
      </table>
    </div>
  <% end %>
<% end %>
